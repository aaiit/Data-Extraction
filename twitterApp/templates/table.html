{% extends "base.html" %}
{% load static %}

{% block content %}
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet" id="bootstrap-css">


<div class="btn-toolbar">
    <button onclick="Exporter()"class="btn" >Import Json</button>
    <button onclick="csvfile()" class="btn" >Import CSV</button>
    <button onclick="coperUrl()" class="btn" >Copy url</button>
</div>
<div class="well">
    <table class="table">
      <thead>
        <tr>
          {% for c in C%}
          <th> {{c}}</th>
          {% endfor %}
         <!--  <th>#</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Username</th> -->
          <th style="width: 36px;"></th>
        </tr>
      </thead>
      <tbody>
        {% for d in data%}
        <tr>
          {%for dd in d%}
          <td>{{dd}}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
</div>

<div class="modal small hide fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="myModalLabel">Delete Confirmation</h3>
    </div>
    <div class="modal-body">
        <p class="error-text">Are you sure you want to delete the user?</p>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <button class="btn btn-danger" data-dismiss="modal">Delete</button>
    </div>
</div>





<script type="text/javascript">
    var data={{ JSON|safe }};
    function getjson(){
      return JSON.stringify(data);
    }
    function getdata(){
      return data;
    }
</script>


 <script type="text/javascript">
      function download(filename, text) {
      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
      element.setAttribute('download', filename);
      element.style.display = 'none';
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    };

    function Exporter(){
      download('{{id}}.json',getjson());
    }

  </script>

<script type="text/javascript">
// JSON to CSV Converter
        function ConvertToCSV(objArray) {
            var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
            var str = '';

            for (var i = 0; i < array.length; i++) {
                var line = '';
                for (var index in array[i]) {
                    if (line != '') line += ','

                    line += array[i][index];
                }

                str += line + '\r\n';
            }

            return str;
        }

        // Convert Object to JSON
        var jsonObject = JSON.stringify(getdata());


        // Convert JSON to CSV & Display CSV
        function csvfile(){
          download('{{id}}.csv',ConvertToCSV(jsonObject));
        };
      
</script>


<script type="text/javascript">
  function coperUrl() {
  const el = document.createElement('textarea');
  el.value = "https://dextraction.herokuapp.com/table?a={{id}}";
  document.body.appendChild(el);
  el.select();
  document.execCommand('copy');
  document.body.removeChild(el);
}
</script>
{% endblock %}